\chapter{Free Lossless Audio Codec}
FLAC compresses PCM audio data losslessly using predictors and a
residual.
FLACs contain checksumming to verify their integrity, contain comment tags for
metadata and are streamable.

Except for the contents of the VORBIS\_COMMENT metadata block, everything in FLAC is big-endian.

\section{the FLAC File Stream}
\begin{figure}[h]
\includegraphics{figures/flac_stream.pdf}
\end{figure}
\par
\noindent
``Last'' is 0 when there are no additional metadata blocks and 1 when
it is the final block before the the audio frames.
``Block Length'' is the size of the metadata block data to follow,
not including the header.
\begin{figure}[h]
\begin{tabular}{| r | l |}
\hline
Block Type & Block \\
\hline
\texttt{0} & STREAMINFO \\
\texttt{1} & PADDING \\
\texttt{2} & APPLICATION \\
\texttt{3} & SEEKTABLE \\
\texttt{4} & VORBIS\_COMMENT \\
\texttt{5} & CUESHEET \\
\texttt{6} & PICTURE \\
\texttt{7-126} & reserved \\
\texttt{127} & invalid \\
\hline
\end{tabular}
\end{figure}

\pagebreak

\section{FLAC Metadata Blocks}

\subsection{STREAMINFO}
\begin{figure}[h]
\includegraphics{figures/flac_streaminfo.pdf}
\end{figure}

\subsection{PADDING}

PADDING is simply a block full of NULL (\texttt{0x00}) bytes.
Its purpose is to provide extra metadata space within the FLAC file.
By having a padding block, other metadata blocks can be grown or
shrunk without having to rewrite the entire FLAC file by removing or
adding space to the padding.


\subsection{APPLICATION}
\begin{figure}[h]
\includegraphics{figures/flac_application.pdf}
\end{figure}
\noindent
APPLICATION is a general-purpose metadata block used by a variety of
different programs.
Its contents are defined by the ASCII Application ID value.

\subsection{SEEKTABLE}
\begin{figure}[h]
\includegraphics{figures/flac_seektable.pdf}
\end{figure}

\pagebreak

\subsection{VORBIS\_COMMENT}
\begin{figure}[h]
\includegraphics{figures/flac_vorbiscomment.pdf}
\end{figure}
\par
\noindent
The length fields are all little-endian.
The Vendor String and Comment Strings are all UTF-8 encoded.
Keys are not case-sensitive and may occur multiple times,
indicating multiple values for the same field.
For instance, a track with multiple artists may have
more than one \texttt{ARTIST}.

\begin{minipage}{\linewidth}
\renewcommand\thefootnote{\thempfootnote}
{\relsize{-1}
\begin{tabular}{|r|l|}
\hline
key & value \\
\hline
ALBUM & album name \\
ARTIST & artist name, band name, composer, author, etc. \\
CATALOGNUMBER\footnote{These are proposed extension fields and not part of the official Vorbis comment specification.} & CD spine number \\
COMPOSER\footnotemark[\value{mpfootnote}] & the work's author \\
CONDUCTOR\footnotemark[\value{mpfootnote}] & performing ensemble's leader \\
COPYRIGHT & copyright attribution \\
DATE & recording date \\
DESCRIPTION & a short description \\
DISCNUMBER\footnotemark[\value{mpfootnote}] & disc number for multi-volume work \\
ENGINEER\footnotemark[\value{mpfootnote}] & the recording masterer \\
ENSEMBLE\footnotemark[\value{mpfootnote}] & performing group \\
GENRE & a short music genre label \\
GUEST ARTIST\footnotemark[\value{mpfootnote}] & collaborating artist \\
ISRC & ISRC number for the track \\
LICENSE & license information \\
LOCATION & recording location \\
OPUS\footnotemark[\value{mpfootnote}] & number of the work \\
ORGANIZATION & record label \\
PART\footnotemark[\value{mpfootnote}] & track's movement title \\
PERFORMER & performer name, orchestra, actor, etc. \\
PRODUCER\footnotemark[\value{mpfootnote}] & person responsible for the project \\
PRODUCTNUMBER\footnotemark[\value{mpfootnote}] & UPC, EAN, or JAN code \\
PUBLISHER\footnotemark[\value{mpfootnote}] & album's publisher \\
RELEASE DATE\footnotemark[\value{mpfootnote}] & date the album was published \\
REMIXER\footnotemark[\value{mpfootnote}] & person who created the remix \\
SOURCE ARTIST\footnotemark[\value{mpfootnote}] & artist of the work being performed \\
SOURCE MEDIUM\footnotemark[\value{mpfootnote}] & CD, radio, cassette, vinyl LP, etc. \\
SOURCE WORK\footnotemark[\value{mpfootnote}] & a soundtrack's original work \\
SPARS\footnotemark[\value{mpfootnote}] & DDD, ADD, AAD, etc. \\
SUBTITLE\footnotemark[\value{mpfootnote}] & for multiple track names in a single file \\
TITLE & track name \\
TRACKNUMBER & track number \\
VERSION & track version \\
\hline
\end{tabular}
}
\end{minipage}

\pagebreak

\subsection{CUESHEET}
\begin{figure}[h]
\includegraphics{figures/flac_cuesheet.pdf}
\end{figure}

\subsection{PICTURE}
\begin{figure}[h]
\includegraphics{figures/flac_picture.pdf}
\end{figure}
\begin{tabular}{|r|l|}
\hline
Picture Type & Type \\
\hline
0 & Other \\
1 & 32x32 pixels `file icon' (PNG only) \\
2 & Other file icon \\
3 & Cover (front) \\
4 & Cover (back) \\
5 & Leaflet page \\
6 & Media (e.g. label side of CD) \\
7 & Lead artist / Lead performer / Soloist \\
8 & Artist / Performer \\
9 & Conductor \\
10 & Band / Orchestra \\
11 & Composer \\
12 & Lyricist / Text writer \\
13 & Recording location \\
14 & During recording \\
15 & During performance \\
16 & Movie / Video screen capture \\
17 & A bright coloured fish \\
18 & Illustration \\
19 & Band / Artist logotype \\
20 & Publisher / Studio logotype \\
\hline
\end{tabular}

\section{FLAC Decoding}
A FLAC stream is made up of individual FLAC frames, as follows:
\begin{figure}[h]
\includegraphics{figures/flac_frame.pdf}
\end{figure}

\begin{figure}[h]
\begin{tiny}
\begin{tabular}{|c|r|r|r|l|r|c|}
\hline
Value & Block Size & Sample Rate & Channels & Assignment & Bits per Sample & Value \\
\hline
\texttt{0000} & STREAMINFO & STREAMINFO & 1 & front center & STREAMINFO & \texttt{0000} \\
\texttt{0001} & 192 & 88200 & 2 & front left, front right & 8 & \texttt{0001} \\
\texttt{0010} & 576 & 176400 & 3 & f. left, f. right, f. center & 12 & \texttt{0010} \\
\texttt{0011} & 1152 & 192000 & 4 & f. left, f. right, back left, back right & reserved & \texttt{0011} \\
\texttt{0100} & 2304 & 8000 & 5 & f. L, f. R, f. C, b. L, b. R & 16 & \texttt{0100} \\
\texttt{0101} & 4608 & 16000 & 6 & f. L, f. R, f. C, LFE, b. L, b. R & 20 & \texttt{0101} \\
\texttt{0110} & 8 bits (+1) & 22050 & 7 & undefined & 24 & \texttt{0110} \\
\texttt{0111} & 16 bits (+1) & 24000 & 8 & undefined & reserved & \texttt{0111} \\
\texttt{1000} & 256 & 32000 & 2 & 0 left, 1 difference & & \texttt{1000} \\
\texttt{1001} & 512 & 44100 & 2 & 0 difference, 1 right & & \texttt{1001} \\
\texttt{1010} & 1024 & 48000 & 2 & 0 average, 1 difference & & \texttt{1010} \\
\texttt{1011} & 2048 & 96000 & & reserved & & \texttt{1011} \\
\texttt{1100} & 4096 & 8 bits (in kHz) & & reserved & & \texttt{1100} \\
\texttt{1101} & 8192 & 16 bits (in Hz) & & reserved & & \texttt{1101} \\
\texttt{1110} & 16384 & 16 bits (in 10s of Hz) & & reserved & & \texttt{1110} \\
\texttt{1111} & 32768 & invalid & & reserved & & \texttt{1111} \\
\hline
\end{tabular}
\end{tiny}
\end{figure}
\par
\parpic[r]{
\begin{tabular}{|c|l|}
\hline
Value & Subframe Type \\
\hline
\texttt{000000} & \texttt{SUBFRAME\_CONSTANT} \\
\texttt{000001} & \texttt{SUBFRAME\_VERBATIM} \\
\texttt{00001x} & reserved \\
\texttt{0001xx} & reserved \\
\texttt{001xxx} & \texttt{SUBFRAME\_FIXED} \\
& \texttt{xxx} = predictor order \\
\texttt{01xxxx} & reserved \\
\texttt{1xxxxx} & \texttt{SUBFRAME\_LPC} \\
& \texttt{xxxxx} = predictor order - 1 \\
\hline
\end{tabular}
}
\noindent
Sample/Frame Number is a UTF-8 coded value.
If the blocking strategy is 0, it decodes to a 32-bit frame number.
If the blocking strategy is 1, it decodes to a 36-bit sample number.

There is one Subframe per channel.

`Wasted Bits Per Sample' is typically a single bit set to 0, indicating
no wasted bits per sample.  If set to 1, a unary-encoded value
follows which indicates how many bits are wasted per sample.

Padding is added as needed between the final subframe and CRC-16
in order to byte-align frames.
