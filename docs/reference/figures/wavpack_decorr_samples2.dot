digraph read_wavpack_samples {
  init [shape=record,label="{input samples|input samples_count|input terms|input terms_count|input channel_count}"];
  init_i [shape=box,label="i = terms_count - 1\nj = 0"];

  init -> init_i -> check_i;
  check_i [shape=diamond,label="is\ni >= 0?"];

  check_i -> done [label="NO"];
  check_i -> check_term_17_18 [label="YES"];

  decrement_i [shape=record,label="i = i - 1"];
  decrement_i -> check_i;

  check_term_17_18 [shape=diamond,label="is\n17 ≤ term[i] ≤ 18?"];
  update_17_18_mono [shape=record,label="{decorr. samples A[i][0] = samples[j + 1]|decorr. samples A[i][1] = samples[j]|j = j + 2}"];
  check_17_18_mono [shape=diamond,label="is\nchannel_count > 1?"];
  update_17_18_stereo [shape=record,label="{decorr. samples B[i][0] = samples[j + 1]|decorr. samples B[i][1] = samples[j]|j = j + 2}"];

  check_term_17_18 -> update_17_18_mono [label="YES"];
  check_term_17_18 -> check_term_1_8 [label="NO"];
  update_17_18_mono -> check_17_18_mono;
  check_17_18_mono -> update_17_18_stereo [label="YES"];
  check_17_18_mono -> decrement_i [label="NO"];
  update_17_18_stereo -> decrement_i;

  check_term_1_8 [shape=diamond,label="is\n1 ≤ term[i] ≤ 8?"];
  check_term_1_8 -> init_k [label="YES"];
  check_term_1_8 -> check_neg_term [label="NO"];

  init_k [shape=record,label="k = term[i]"];
  check_k [shape=diamond,label="is\nk > 0?"];
  check_k -> decrement_i [label="NO"];
  check_k -> update_k_mono [label="YES"];

  update_k_mono [shape=record,label="{decorr. samples A[i][k] = samples[j]|j = j + 1}"];
  update_k_mono -> check_k_stereo;
  check_k_stereo [shape=diamond,label="is\nchannel_count > 1?"];
  update_k_stereo [shape=record,label="{decorr. samples B[i][k] = samples[j]|j = j + 1}"];
  check_k_stereo -> update_k_stereo [label="YES"];
  check_k_stereo -> decrement_k [label="NO"];
  update_k_stereo -> decrement_k;

  decrement_k [shape=record,label="k = k - 1"];
  decrement_k -> check_k;

  init_k -> check_k;

  check_neg_term [shape=diamond,label="is\n-3 ≤ term[i] ≤ -1"];
  check_neg_term -> update_neg_mono [label="YES"];
  check_neg_term -> error [label="NO"];

  update_neg_mono [shape=record,label="{decorr. samples A[i][0] = samples[j]|j = j + 1}"];
  check_neg_stereo [shape=diamond,label="is\nchannel_count > 1?"];
  update_neg_stereo [shape=record,label="{decorr. samples B[i][0] = samples[j]|j = j + 1}"];

  update_neg_mono -> check_neg_stereo;
  check_neg_stereo -> update_neg_stereo [label="YES"];
  check_neg_stereo -> decrement_i [label="NO"];
  update_neg_stereo -> decrement_i;

  error [shape=box,label="unsupported term"];

  done [shape=box,label="done"];
}
