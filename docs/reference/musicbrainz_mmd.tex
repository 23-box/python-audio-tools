%% Relax NG Schema for MusicBrainz XML Metadata Version 1.4
%% This XML schema has been designed to represent music metadata.
%% Documentation and the latest revision can be found at
%% http://musicbrainz.org/development/mmd/
%% Copyright (c) 2006 Robert Kaye, Matthias Friedrich
%% The schema is released under the Creative Commons
%% Attribution-ShareAlike 2.5 license.
%% http://creativecommons.org/licenses/by-sa/2.5/

\section{MusicBrainz XML}

The following is the complete specification for MusicBrainz XML output
in RELAX NG Compact syntax from
\texttt{http://bugs.musicbrainz.org/browser/mmd-schema/trunk/schema}
and converted to compact syntax for better readability.

\begin{Verbatim}[fontsize=\relsize{-2},frame=lines,framesep=.25in,label={[Schema Start]Schema End}]
namespace local = ""
default namespace ns1 = "http://musicbrainz.org/ns/mmd-2.0#"

start = def_metadata-element
def_metadata-element =
  element metadata {
    attribute generator { xsd:anyURI }?,
    attribute created { xsd:dateTime }?,
    def_artist-element?,
    def_release-element?,
    def_release-group-element?,
    def_recording-element?,
    def_label-element?,
    def_work-element?,
    def_url-element?,
    def_puid-element?,
    def_isrc-element?,
    def_disc-element?,
    def_rating?,
    def_user-rating?,
    def_collection?,
    def_artist-list?,
    def_release-list?,
    def_release-group-list?,
    def_recording-list?,
    def_label-list?,
    def_work-list?,
    def_isrc-list?,
    def_annotation-list?,
    def_cdstub-list?,
    def_freedb-disc-list?,
    def_tag-list?,
    def_user-tag-list?,
    def_collection-list?,
    def_entity-list?,
    def_metadata-element_extension
  }
def_artist-element =
  element artist {
    attribute id { xsd:anyURI }?,
    attribute type { xsd:anyURI }?,
    def_artist-attribute_extension,
    element name { text }?,
    element sort-name { text }?,
    element gender { text }?,
    element country { def_iso-3166 }?,
    def_annotation?,
    element disambiguation { text }?,
    element ipi { def_ipi }?,
    def_ipi-list?,
    element life-span {
      element begin { def_incomplete-date }?,
      element end { def_incomplete-date }?,
      def_ended?
    }?,
    def_alias-list?,
    def_recording-list?,
    def_release-list?,
    def_release-group-list?,
    def_label-list?,
    def_work-list?,
    def_relation-list*,
    def_tag-list?,
    def_user-tag-list?,
    def_rating?,
    def_user-rating?,
    def_artist-element_extension
  }
def_release-element =
  element release {
    attribute id { xsd:anyURI }?,
    def_release-attribute_extension,
    element title { text }?,
    element status { text }?,
    element quality { def_quality }?,
    def_annotation?,
    element disambiguation { text }?,
    element packaging { text }?,
    element text-representation {
      element language { def_iso-639 }?,
      element script { def_iso-15924 }?
    }?,
    def_artist-credit?,
    def_release-group-element?,
    element date { def_incomplete-date }?,
    element country { def_iso-3166 }?,
    element barcode { text }?,
    element asin {
      xsd:string { pattern = "[A-Z0-9]{10}" }
    }?,
    def_cover-art-archive?,
    def_label-info-list?,
    def_medium-list?,
    def_relation-list*,
    def_tag-list?,
    def_user-tag-list?,
    def_collection-list?,
    def_release-element_extension
  }
def_release-group-element =
  element release-group {
    attribute id { xsd:anyURI }?,
    attribute type { xsd:anyURI }?,
    def_release-group-attribute_extension,
    element title { text }?,
    def_annotation?,
    element disambiguation { text }?,
    element first-release-date { def_incomplete-date }?,
    element primary-type { text }?,
    element secondary-type-list {
      (element secondary-type { text }*)?
    }?,
    def_artist-credit?,
    def_release-list?,
    def_relation-list*,
    def_tag-list?,
    def_user-tag-list?,
    def_rating?,
    def_user-rating?,
    def_release-group-element_extension
  }
def_recording-element =
  element recording {
    attribute id { xsd:anyURI }?,
    def_recording-attribute_extension,
    element title { text }?,
    element length { xsd:nonNegativeInteger }?,
    def_annotation?,
    element disambiguation { text }?,
    def_artist-credit?,
    def_release-list?,
    def_puid-list?,
    def_isrc-list?,
    def_relation-list*,
    def_tag-list?,
    def_user-tag-list?,
    def_rating?,
    def_user-rating?,
    def_recording-element_extension
  }
def_label-element =
  element label {
    attribute id { xsd:anyURI }?,
    attribute type { xsd:anyURI }?,
    def_label-attribute_extension,
    element name { text }?,
    element sort-name { text }?,
    element label-code { xsd:nonNegativeInteger }?,
    element ipi { def_ipi }?,
    def_ipi-list?,
    def_annotation?,
    element disambiguation { text }?,
    element country { def_iso-3166 }?,
    element life-span {
      element begin { def_incomplete-date }?,
      element end { def_incomplete-date }?,
      def_ended?
    }?,
    def_alias-list?,
    def_release-list?,
    def_relation-list*,
    def_tag-list?,
    def_user-tag-list?,
    def_rating?,
    def_user-rating?,
    def_label-element_extension
  }
def_work-element =
  element work {
    attribute id { xsd:anyURI }?,
    attribute type { xsd:anyURI }?,
    def_work-attribute_extension,
    element title { text }?,
    element language { def_iso-639 }?,
    def_artist-credit?,
    def_iswc-element?,
    def_iswc-list?,
    def_annotation?,
    element disambiguation { text }?,
    def_alias-list?,
    def_relation-list*,
    def_tag-list?,
    def_user-tag-list?,
    def_rating?,
    def_user-rating?,
    def_work-element_extension
  }
def_url-element =
  element url {
    attribute id { xsd:anyURI }?,
    element resource { text }?,
    def_relation-list*
  }
def_disc-element =
  element disc {
    attribute id {
      xsd:string { pattern = "[a-zA-Z0-9._]{27}-" }
    },
    def_disc-attribute_extension,
    element sectors { xsd:nonNegativeInteger }?,
    def_release-list?,
    def_disc-element_extension
  }
def_puid-element =
  element puid {
    attribute id { def_uuid }?,
    def_puid-attribute_extension,
    def_recording-list?,
    def_puid-element_extension
  }
def_isrc-element =
  element isrc {
    attribute id { def_isrc }?,
    def_isrc-attribute_extension,
    def_recording-list?,
    def_isrc-element_extension
  }
def_artist-credit =
  element artist-credit {
    element name-credit {
      attribute joinphrase { text }?,
      element name { text }?,
      def_artist-element
    }+
  }
def_relation-element =
  element relation {
    attribute type { xsd:anyURI },
    attribute type-id { xsd:anyURI },
    element target {
      attribute id { xsd:anyURI }?,
      xsd:anyURI
    },
    element direction { def_direction }?,
    def_attribute-list?,
    element begin { def_incomplete-date }?,
    element end { def_incomplete-date }?,
    def_ended?,
    (def_artist-element
     | def_release-element
     | def_release-group-element
     | def_recording-element
     | def_label-element
     | def_work-element
     | def_relation-element_extension)?
  }
def_alias =
  element alias {
    attribute locale { def_iso-3166-2 }?,
    attribute sort-name { text }?,
    attribute type { text }?,
    attribute primary { text }?,
    attribute begin-date { def_incomplete-date }?,
    attribute end-date { def_incomplete-date }?,
    text
  }
def_iswc-element = element iswc { def_iswc? }
def_tag =
  element tag {
    attribute count { xsd:nonNegativeInteger }?,
    def_tag-attribute_extension,
    element name { text }
  }
def_user-tag =
  element user-tag {
    def_tag-attribute_extension,
    element name { text }
  }
def_rating =
  element rating {
    attribute votes-count { xsd:nonNegativeInteger }?,
    xsd:float
  }
def_user-rating = element user-rating { xsd:nonNegativeInteger }
def_label-info =
  element label-info {
    element catalog-number { text }?,
    def_label-element?
  }
def_medium =
  element medium {
    element title { text }?,
    element position { xsd:nonNegativeInteger }?,
    element format { text }?,
    def_disc-list?,
    def_track-list
  }
def_track =
  element track {
    element position { xsd:nonNegativeInteger }?,
    element number { text }?,
    element title { text }?,
    element length { xsd:nonNegativeInteger }?,
    def_artist-credit?,
    def_recording-element?
  }
def_annotation =
  element annotation {
    attribute type { text }?,
    def_annotation-attribute_extension,
    element entity { xsd:anyURI }?,
    element name { text }?,
    element text { text },
    def_annotation-element_extension
  }
def_cdstub =
  element cdstub {
    attribute id {
      xsd:string { pattern = "[a-zA-Z0-9._]{27}-" }
    },
    def_cdstub-attribute_extension,
    element title { text },
    element artist { text }?,
    element barcode { text }?,
    element comment { text }?,
    def_nonmb-track-list,
    def_cdstub-element_extension
  }
def_freedb-disc =
  element freedb-disc {
    attribute id {
      xsd:string { pattern = "[a-zA-Z0-9]{8}" }
    }?,
    def_freedb-disc-attribute_extension,
    element title { text },
    element artist { text }?,
    element category { text }?,
    element year {
      xsd:string { pattern = "[0-9]{4}" }
    }?,
    def_nonmb-track-list,
    def_freedb-disc-element_extension
  }
def_nonmb-track =
  element track {
    element title { text },
    element artist { text }?,
    element length { xsd:nonNegativeInteger }
  }
def_collection =
  element collection {
    attribute id { xsd:anyURI }?,
    element name { text },
    element editor { text }?,
    def_release-list
  }
# This part defines the extensions elements and attributes.
def_metadata-element_extension = def_extension_element?
def_artist-element_extension = def_extension_element*
def_release-element_extension = def_extension_element*
def_release-group-element_extension = def_extension_element*
def_recording-element_extension = def_extension_element*
def_label-element_extension = def_extension_element*
def_work-element_extension = def_extension_element*
def_puid-element_extension = def_extension_element*
def_isrc-element_extension = def_extension_element*
def_relation-element_extension = def_extension_element
def_annotation-element_extension = def_extension_element*
def_disc-element_extension = def_extension_element*
def_cdstub-element_extension = def_extension_element*
def_freedb-disc-element_extension = def_extension_element*
def_artist-attribute_extension = def_extension_attribute*
def_release-attribute_extension = def_extension_attribute*
def_release-group-attribute_extension = def_extension_attribute*
def_recording-attribute_extension = def_extension_attribute*
def_label-attribute_extension = def_extension_attribute*
def_work-attribute_extension = def_extension_attribute*
def_puid-attribute_extension = def_extension_attribute*
def_isrc-attribute_extension = def_extension_attribute*
def_annotation-attribute_extension = def_extension_attribute*
def_disc-attribute_extension = def_extension_attribute*
def_cdstub-attribute_extension = def_extension_attribute*
def_freedb-disc-attribute_extension = def_extension_attribute*
def_tag-attribute_extension = def_extension_attribute*
def_extension_element =
  element * - (ns1:* | local:*) {
    (attribute * { text }
     | text
     | def_anything)*
  }
def_extension_attribute = attribute * - (ns1:* | local:*) { text }
def_anything =
  element * - local:* {
    (attribute * { text }
     | text
     | def_anything)*
  }
def_artist-list =
  element artist-list { def_list-attributes, def_artist-element* }
def_medium-list =
  element medium-list {
    def_list-attributes,
    element track-count { xsd:nonNegativeInteger }?,
    def_medium*
  }
def_release-list =
  element release-list { def_list-attributes, def_release-element* }
def_release-group-list =
  element release-group-list {
    def_list-attributes, def_release-group-element*
  }
def_alias-list = element alias-list { def_list-attributes, def_alias* }
def_recording-list =
  element recording-list { def_list-attributes, def_recording-element* }
def_track-list = element track-list { def_list-attributes, def_track* }
def_label-list =
  element label-list { def_list-attributes, def_label-element* }
def_label-info-list =
  element label-info-list { def_list-attributes, def_label-info* }
def_work-list =
  element work-list { def_list-attributes, def_work-element* }
def_annotation-list =
  element annotation-list { def_list-attributes, def_annotation* }
def_cdstub-list =
  element cdstub-list { def_list-attributes, def_cdstub* }
def_nonmb-track-list =
  element track-list { def_list-attributes, def_nonmb-track* }
def_freedb-disc-list =
  element freedb-disc-list { def_list-attributes, def_freedb-disc* }
def_disc-list =
  element disc-list { def_list-attributes, def_disc-element* }
def_puid-list =
  element puid-list { def_list-attributes, def_puid-element* }
def_isrc-list =
  element isrc-list { def_list-attributes, def_isrc-element* }
def_relation-list =
  element relation-list {
    attribute target-type { xsd:anyURI },
    def_list-attributes,
    def_relation-element*
  }
def_tag-list = element tag-list { def_list-attributes, def_tag* }
def_iswc-list =
  element iswc-list { def_list-attributes, def_iswc-element* }
def_user-tag-list =
  element user-tag-list { def_list-attributes, def_user-tag* }
def_collection-list =
  element collection-list { def_list-attributes, def_collection* }
def_entity-list =
  element entity-list {
    def_list-attributes,
    (def_artist-element,
     def_release-element,
     def_release-group-element,
     def_recording-element,
     def_label-element,
     def_work-element)*
  }
# the list of attributes on a relationship.
def_attribute-list =
  element attribute-list {
    element attribute { text }+
  }
# the attributes which can be used on a -list element.
def_list-attributes =
  attribute count { xsd:nonNegativeInteger }?,
  attribute offset { xsd:nonNegativeInteger }?
def_cover-art-archive =
  element cover-art-archive {
    element artwork { "true" | "false" },
    element count { xsd:nonNegativeInteger },
    element front { "true" | "false" },
    element back { "true" | "false" },
    element darkened { "true" }?
  }
# A date with varying precision in format 'YYYY-MM-DD'.
def_incomplete-date =
  xsd:string { pattern = "[0-9]{4}(-[0-9]{2})?(-[0-9]{2})?" }
# An IPI code
def_ipi = xsd:string { pattern = "[0-9]{11}" }
def_ipi-list =
  element ipi-list {
    element ipi { def_ipi }*
  }
def_ended = element ended { "true" }
# A two-letter country code like 'DE', 'UK', 'FR' etc.
def_iso-3166 = xsd:string { pattern = "[A-Z]{2}" }
# A two-letter country code like followed by a 3 letter subdivision
def_iso-3166-2 = xsd:string { pattern = "[A-Z]{2}\-[A-Z]{2}" }
# An ISO-639 Part 3 language code like 'deu', 'eng', 'jpn' etc.
def_iso-639 = xsd:string { pattern = "[a-z]{3}" }
# A four-letter script code like 'Latn', 'Cyrl', etc.
def_iso-15924 = xsd:string { pattern = "[A-Z][a-z]{3}" }
# An ISRC code: CCXXXYYNNNNN, with
# CC    - two-letter ISO-3166-1 alpha 2 country code
# XXX   - alphanumeric registrant code (organization)
# YY    - year
# NNNNN - 5-digit number
def_isrc =
  xsd:string { pattern = "[A-Z]{2}[A-Z0-9]{3}[0-9]{2}[0-9]{5}" }
# An ISWC code: 
# C           - single-letter prefix character
# NNN.NNN.NNN - 9-digit number. A "."-separated grouping in
#               3x3 digits is commonly used.  This grouping
#               is allowed by the standard, but not
#               mandatory.  For consistency we force this
#               grouping in the schema.
# C           - check digit
def_iswc =
  xsd:string { pattern = "[A-Z]-[0-9]{3}\.[0-9]{3}\.[0-9]{3}-[0-9]" }
# A 128 Bit UUID in its standard ASCII representation.
def_uuid =
  xsd:string { pattern = "[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}" }
# Reading direction of a relation. Defaults to "both".
def_direction = "both" | "forward" | "backward"
# Data Quality of an entity.
def_quality = "low" | "normal" | "high"
\end{Verbatim}
