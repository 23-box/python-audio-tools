#!/usr/bin/python

#Audio Tools, a module and set of tools for manipulating audio data
#Copyright (C) 2007  Brian Langenberger

#This program is free software; you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation; either version 2 of the License, or
#(at your option) any later version.

#This program is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.

#You should have received a copy of the GNU General Public License
#along with this program; if not, write to the Free Software
#Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA


import sys
import audiotools
import os.path,optparse

if (__name__ == '__main__'):
    parser = optparse.OptionParser(
        "%prog [-x XMCD file] <track 1> [track 2] ...",
        version="Python Audio Tools %s" % (audiotools.VERSION))

    parser.add_option('--track',
                      action='store',
                      type='string',
                      dest='track_name',
                      help="the name of the track")

    parser.add_option('--number',
                      action='store',
                      type='int',
                      dest='track_number',
                      help="the number of the track in the album")
    
    parser.add_option('--album',
                      action='store',
                      type='string',
                      dest='album_name',
                      help='the name of the album')

    parser.add_option('--artist',
                      action='store',
                      type='string',
                      dest='artist_name',
                      help='the name of the artist')

    parser.add_option('--performer',
                      action='store',
                      type='string',
                      dest='performer_name',
                      help='the name of the performer')

    parser.add_option('--copyright',
                      action='store',
                      type='string',
                      dest='copyright',
                      help='copyright information')

    parser.add_option('--year',
                      action='store',
                      type='string',
                      dest='year',
                      help='the year of release')

    parser.add_option('-r','--replace',
                      action='store_true',
                      default=False,
                      dest='replace',
                      help='completely replace all metadata')

    (options,args) = parser.parse_args()
    audiofiles = audiotools.open_files(args)

    for file in audiofiles:
        if (options.replace):
            #this is a horrible way of handling default variables
            #which will be replaced once Python2.5 is more widespread
            metadata = audiotools.MetaData(
                track_name={None:""}.get(options.track_name,
                                         options.track_name),
                track_number={None:0}.get(options.track_number,
                                           options.track_number),
                album_name={None:""}.get(options.album_name,
                                         options.album_name),
                artist_name={None:""}.get(options.artist_name,
                                          options.artist_name),
                performer_name={None:""}.get(options.performer_name,
                                             options.performer_name),
                copyright={None:""}.get(options.copyright,
                                         options.copyright),
                year={None:""}.get(options.year,
                                   options.year))
            
            file.set_metadata(metadata)
        else:
            metadata = file.get_metadata()
            if (metadata != None):
                for field in ('track_name','track_number','album_name',
                              'artist_name','performer_name','copyright',
                              'year'):
                    if (getattr(options,field) != None):
                        setattr(metadata,field,getattr(options,field))
                file.set_metadata(metadata)
                
